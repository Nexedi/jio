

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Revision Storages: Conflicts and Resolution &mdash; JIO 2.0.0 documentation</title>
    
    <link rel="stylesheet" href="_static/default.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '2.0.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="JIO 2.0.0 documentation" href="index.html" />
    <link rel="next" title="List of Available Storages" href="available_storages.html" />
    <link rel="prev" title="How to manage documents?" href="manage_documents.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="available_storages.html" title="List of Available Storages"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="manage_documents.html" title="How to manage documents?"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">JIO 2.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="revision-storages-conflicts-and-resolution">
<h1>Revision Storages: Conflicts and Resolution<a class="headerlink" href="#revision-storages-conflicts-and-resolution" title="Permalink to this headline">¶</a></h1>
<div class="section" id="why-conflicts-can-occur">
<h2>Why Conflicts can Occur<a class="headerlink" href="#why-conflicts-can-occur" title="Permalink to this headline">¶</a></h2>
<p>Using jIO you can store documents in multiple storage locations. With
increasing number of users working on a document and some storages not being
available or responding too slow, conflicts are more likely to occur. JIO
defines a conflict as multiple versions of a document existing in a storage
tree and a user trying to save on a version that does not match the latest
version of the document.</p>
<p>To keep track of document versions a revision storage must be used. When doing
so, jIO creates a document tree file for every document. This file contains all
existing versions and their status and is modified whenever a version is
added/updated/removed or when storages are being synchronized.</p>
</div>
<div class="section" id="how-to-solve-conflicts">
<h2>How to solve conflicts<a class="headerlink" href="#how-to-solve-conflicts" title="Permalink to this headline">¶</a></h2>
<p>Using the document tree, jIO tries to make every version of a document
available on every storage. When multiple versions of a document exist, jIO
will select the <strong>latest</strong>, <strong>left-most</strong> version on the document tree, along with the
conflicting versions (when option <strong>conflicts: true</strong> is set in order for
developers to setup a routine to solve conflicts.</p>
<p>Technically a conflict is solved by deleting alternative versions of a document
(&#8220;cutting leaves off from the document tree&#8221;). When a user decides to keep a
version of a document and manually deletes all conflicting versions, the
storage tree is updated accordingly and the document is available in a single
version on all storages.</p>
</div>
<div class="section" id="simple-conflict-example">
<h2>Simple Conflict Example<a class="headerlink" href="#simple-conflict-example" title="Permalink to this headline">¶</a></h2>
<p>You are keeping a namecard file on your PC updating from your smartphone. Your
smartphone ran out of battery and is offline when you update your namecard on
your PC with your new email adress. Someone else change this email from your PC
and once your smartphone is recharged, you go back online and the previous
update is executed.</p>
<ol class="arabic simple">
<li>Setting up the storage tree</li>
</ol>
<blockquote>
<div><div class="highlight-javascript"><div class="highlight"><pre><span class="kd">var</span> <span class="nx">jio_instance</span> <span class="o">=</span> <span class="nx">jIO</span><span class="p">.</span><span class="nx">newJio</span><span class="p">({</span>
  <span class="c1">// replicate revision storage</span>
  <span class="s2">&quot;type&quot;</span><span class="o">:</span><span class="s2">&quot;replicaterevision&quot;</span><span class="p">,</span>
  <span class="s2">&quot;storagelist&quot;</span><span class="o">:</span><span class="p">[{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;revision&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sub_storage&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;dav&quot;</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">},</span> <span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;revision&quot;</span><span class="p">,</span>
    <span class="s2">&quot;sub_storage&quot;</span><span class="o">:</span> <span class="p">{</span>
      <span class="s2">&quot;type&quot;</span><span class="o">:</span> <span class="s2">&quot;local&quot;</span><span class="p">,</span>
      <span class="p">...</span>
    <span class="p">}</span>
  <span class="p">}]</span>
<span class="p">});</span>
</pre></div>
</div>
</div></blockquote>
<ol class="arabic">
<li><p class="first">Create your namecard on your smartphone</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jio_instance</span><span class="p">.</span><span class="nx">post</span><span class="p">({</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span><span class="p">,</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;me@web.com&quot;</span>
 <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>This will create the document on your webDav and local storage</p>
</li>
<li><p class="first">Someone else updates your shared namecard on Webdav</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jio_instance</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
  <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;my_new_me@web.com&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;2-068E73F5B44FEC987B51354DFC772891&quot;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>Your smartphone is offline, so you will now have one version (1-578...) on
your smartphone and another version on webDav (2-068...) on your PC.</p>
</li>
<li><p class="first">You modify your namecard while being offline</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jio_instance</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;1-5782E71F1E4BF698FA3793D9D5A96393&quot;</span>
  <span class="c1">// response.data.email -&gt; &quot;me@web.com&quot;</span>

  <span class="k">return</span> <span class="nx">jio_instance</span><span class="p">.</span><span class="nx">put</span><span class="p">({</span>
    <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span><span class="p">,</span>
    <span class="s2">&quot;email&quot;</span><span class="o">:</span> <span class="s2">&quot;me_again@web.com&quot;</span>
  <span class="p">});</span>

<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;2-3753476B70A49EA4D8C9039E7B04254C&quot;</span>
<span class="p">});</span>
</pre></div>
</div>
</li>
<li><p class="first">Later, your smartphone is online and you retrieve your namecard.</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jio_instance</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span><span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;2-3753476B70A49EA4D8C9039E7B04254C&quot;</span>
  <span class="c1">// response.data.email -&gt; &quot;me_again@web.com&quot;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>When multiple versions of a document are available, jIO returns the latest,
left-most version on the document tree (2-375... and labels all other
versions as conflicting 2-068...).</p>
</li>
<li><p class="first">Retrieve conflicts by setting option</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jio_instance</span><span class="p">.</span><span class="nx">get</span><span class="p">({</span><span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span><span class="p">},</span> <span class="p">{</span>
  <span class="s2">&quot;conflicts&quot;</span><span class="o">:</span> <span class="kc">true</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;2-3753476B70A49EA4D8C9039E7B04254C&quot;,</span>
  <span class="c1">// response.conflicts -&gt; [&quot;2-068E73F5B44FEC987B51354DFC772891&quot;]</span>
<span class="p">});</span>
</pre></div>
</div>
<p>The conflicting version (<em>2-068E...</em>) is displayed, because <strong>{conflicts: true}</strong> was
specified in the GET call. Deleting either version will solve the conflict.</p>
</li>
<li><p class="first">Delete conflicting version</p>
<div class="highlight-javascript"><div class="highlight"><pre><span class="nx">jio_instance</span><span class="p">.</span><span class="nx">remove</span><span class="p">({</span>
  <span class="s2">&quot;_id&quot;</span><span class="o">:</span> <span class="s2">&quot;myNameCard&quot;</span><span class="p">,</span>
  <span class="s2">&quot;_rev&quot;</span><span class="o">:</span> <span class="s2">&quot;2-068E73F5B44FEC987B51354DFC772891&quot;</span>
<span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
  <span class="c1">// response.id -&gt; &quot;myNameCard&quot;</span>
  <span class="c1">// response.rev -&gt; &quot;3-28910A4937537B5168E772896B70EC98&quot;</span>
<span class="p">});</span>
</pre></div>
</div>
<p>When deleting the conflicting version of your namecard, jIO removes this
version from all storages and sets the document tree leaf of this version to
deleted. All storages now contain just a single version of your namecard
(2-3753...). Note that, on the document tree, removing a revison will
create a new revision with status set to <em>deleted</em>.</p>
</li>
</ol>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/jio-logo.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Revision Storages: Conflicts and Resolution</a><ul>
<li><a class="reference internal" href="#why-conflicts-can-occur">Why Conflicts can Occur</a></li>
<li><a class="reference internal" href="#how-to-solve-conflicts">How to solve conflicts</a></li>
<li><a class="reference internal" href="#simple-conflict-example">Simple Conflict Example</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="manage_documents.html"
                        title="previous chapter">How to manage documents?</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="available_storages.html"
                        title="next chapter">List of Available Storages</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/revision_storages.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="available_storages.html" title="List of Available Storages"
             >next</a> |</li>
        <li class="right" >
          <a href="manage_documents.html" title="How to manage documents?"
             >previous</a> |</li>
        <li><a href="index.html">JIO 2.0.0 documentation</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, Nexedi.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>